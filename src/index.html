<html>
<head>
    <script src="../dist/plekryption.js"></script>
</head>
<body>
<script>
    async function go(session)
    {
        /***** BEGIN TESTING **********/
        var pubKey = null;
        var priKey = null;
        var status = null;
        var decChatKey = null;
        var decChatKey2 = null;

        try {
            console.log(`Index: Session: ${session.getStatus()}`);
            session.initiate();
            // if(session.getStatus() === 0){
            //     await session.generateKeys();
            //     console.log(`Genereted Keys - Index: Session: ${session.getStatus()}`);
            // }

            // await session.generateSymKey();
            console.log(`Index: Session: ${session.getStatus()}`);
            console.log(session.getSymKey());
            // session.init().then(function(){
            //     console.log("Set public/private");
            //     return session.genSymKey();

            // }).then(function(chatKey){
            //     console.log("chatKey",chatKey);

            //     return session.setCurrentKey(chatKey);
            // }).catch(function(err){
            //     console.log(err);
            // });
        } catch (err) {
            console.log(err);
        }
    }1
    async function chat(msg){
        try{
            var decMsg = await session.encrypt(msg);
            var encMsg = await session.decrypt(decMsg);

            document.getElementById('stuff').innerHTML += '<hr>';
            document.getElementById('stuff').innerHTML += ('<h3>Cipher</h3><p>'+ decMsg +'</p>');
            document.getElementById('stuff').innerHTML +=('<h3>TEXT</h3><p>'+ encMsg +'</p>');

        } catch (err) {
            console.log(err);
        }
    }
    var session= new Plekryption.session();
    setTimeout(() =>{
        go(session);
    },100)
    

    


    window.onload = function () {
        addHtmlForm();
    };
    function addHtmlForm(){
        var txt = document.createElement("textarea");
        txt.rows = 10;
        txt.cols = 100;
        txt.id = "msg"; // set the CSS class
        document.body.appendChild(txt); // p

        var button = document.createElement('button');
        button.innerText = "Send";
        button.onclick = function () {
            chat(txt.value);
        };
        document.body.appendChild(button);
    }
    function Timer(callback, delay) {
        var timerId, start, remaining = delay;

        this.pause = function() {
            window.clearTimeout(timerId);
            remaining -= new Date() - start;
        };

        this.resume = function() {
            start = new Date();
            window.clearTimeout(timerId);
            timerId = window.setTimeout(callback, remaining);
        };

        this.resume();
    }

   /* session.init().then(function () {
        console.log(session.pubKey);
        return session.genSymKey();
    }).then(function (val){
        console.log(val);
    });*/

    /*var timer = new Timer(function() {
        console.log(session.pubKey);
    }, 1000);*/

</script>
<div id="stuff"></div>
</body>
</html>
